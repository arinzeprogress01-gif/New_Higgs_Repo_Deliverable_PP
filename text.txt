Create Order
OST /order/create
Reads cart
Validates stock
Reserves stock (reduces stock temporarily)
Copies cart â†’ Order + OrderItems
Sets status = "pending"

2ï¸âƒ£ Confirm Payment
POST /order/confirm/{order_id}
Changes status â†’ "paid"
Stock remains reduced permanently

3ï¸âƒ£ Cancel Order
POST /order/cancel/{order_id}
Changes status â†’ "cancelled"
Restores stock
This covers:

âœ” Order cancelled
âœ” Payment incomplete logic
âœ” Stock restoration
âœ” Proper state transitions



Hereâ€™s how order status should behave:

Current Status	Can Go To	Cannot Go To
pending	paid	paid twice
pending	cancelled	cancelled twice
paid	(none)	cancelled
cancelled	(none)	paid


ğŸ“„ SYSTEM OVERVIEW (For Your Documentation)

Hereâ€™s a clean version you can use:

ğŸ— System Overview â€“ Chuks Kitchen Backend

Chuks Kitchen is a food ordering backend system that manages:

User registration

Food listing

Cart operations

Order processing

Payment simulation

Stock management

The system is built using:

FastAPI

SQLAlchemy

SQLite (or your DB)

RESTful architecture

ğŸ”„ Core Flows
1. Registration Flow

User registers â†’ Account created â†’ Can place orders.

2. Food Management Flow (Admin)

Admin:

Add food

Update price

Update stock

Delete food

3. Cart Flow

User:

Add food to cart

Update quantity

Remove item

Clear cart

Stock not affected at this stage.

4. Ordering Flow

User:

Converts cart â†’ Order

Order status = pending

Total calculated and stored

5. Payment Flow

User:

Pays for pending order

System:

Validates stock

Reduces stock permanently

Creates payment record

Marks order as paid

Clears cart

âš ï¸ Edge Cases i Handled

Prevent adding quantity above stock

Prevent reducing cart below 1

Prevent double payment

Prevent paying non-existent order

Prevent paying another userâ€™s order

Revalidate stock at payment time

Prevent stock race issues (basic level)

ğŸ§  Assumptions

You should document:

Payment is simulated (no external gateway)

Orders are instantly paid (no cancellation stage)

No timeout for pending orders

Admin manually manages stock

ğŸ“ˆ Scalability Thoughts

Replace simulated payment with Stripe/Paystack

Add background tasks for email notifications

Add order expiration timer

Add Redis for caching food list

Add role-based authentication (admin vs user)

Use PostgreSQL in production

Add transaction-level DB locking for high concurrency
